
#@author mochaaP
#@tested mpv:0.32.0-410 mpvnet:5.4.8.0

############
# Decoding #
############

#priority = high

# --- Video ---

# -> Hardware decoding
hwdec = auto-copy
hwdec-codecs = all
profile = gpu-hq
gpu-api = d3d11
gpu-shader-cache-dir = "~~/shaders_cache"

fbo-format = auto # auto adapt 16bit float

# enable direct rendering, optimize large resolution vo
vd-lavc-dr = yes
opengl-pbo = yes

swapchain-depth = 8 # prevent missed vsync, but with increased latency

#vd-lavc-threads = 16 # superthreading

# -> Scale
scale = ewa_lanczossharp

scale-antiring=0.7
dscale-antiring=0.7
cscale-antiring=0.7


# -> Interpolation
interpolation=yes

# https://mpv.io/manual/master/#options-tscale
# https://github.com/mpv-player/mpv/issues/2685
tscale = oversample

video-sync = display-resample
#video-sync-max-video-change = 5

# disabled for VFR
# for autospeedwin (calibrates display refresh rate)
#script-opts = autospeed-nircmd=true,autospeed-speed=false,autospeed-nircmdc="C:\nircmd-x64\nircmdc.exe",autospeed-monitor=0,autospeed-dwidth=1920,autospeed-dheight=1080,autospeed-bdepth=32,autospeed-rates="23;24;25;29;30;50;59;60",autospeed-exitrate=60,autospeed-minspeed=0.9,autospeed-maxspeed=1.1,autospeed-osd=true,autospeed-osdtime=10,autospeed-osdkey=y,autospeed-estfps=false,autospeed-spause=4
# Add `nircmdc.exe` to `PATH` or configure absolute path
# `autospeed-rates="23;24;25;29;30;50;59;60",autospeed-exitrate=60` supported refresh rates and reset when exit. e.g. 23=23.976
# `autospeed-spause=4` autopause interval

# -> Dither
dither = error-diffusion

dither-depth = auto
temporal-dither = yes

error-diffusion = burkes
dither-size-fruit = 7 # default = 6, delays mpv launch

# -> Deband
deband = yes
deband-iterations = 4 # deband steps
deband-threshold = 20 # deband strength
deband-range = 16 # deband range
deband-grain = 0 # dynamic grain: set to "0" if using the static grain shader

# -> Color correction
icc-profile-auto = yes
icc-3dlut-size = 256x256x256 # default = 64x64x64, delays mpv launch

icc-contrast = 1000 # hides warnings about ICC errors; disable for OLED displays

#target-prim = auto 
# target-prim = bt.709
# target-prim = bt.2020 # target Rec.2020 (wide color gamut) for HDR TVs
#target-trc = auto
#gamma-auto
#vf=format=colorlevels=full:colormatrix=auto
#video-output-levels=full

# -> Fixes
# video filters (SVP) support
hr-seek-framedrop = no
# use mpvSockets instead of fixed value
input-ipc-server = mpvpipe

# --- Audio ---
ao = wasapi
#audio-exclusive = yes

# -> External
audio-file-auto = fuzzy
#audio-file-paths = audio
alang = 'jpn,ja,eng,en'

#aid = 1 # forces first internal track
# seealso https://github.com/mpv-player/mpv/issues/967#issuecomment-94744964

# -> Fixes
#audio-channels = stereo # force stereo if audio not being played correctly
#audio-normalize-downmix = yes # fixes abnormal volume when mixing multiple tracks

# --- Image ---
# don't slideshow by default
image-display-duration = inf
# loop files in case of webms or gifs
loop-file = inf
# and loop the whole playlist
loop-playlist = inf

##############
# Experience #
##############

# --- UI ---

# -> Input
#input-default-bindings = no
input-ar-delay = 500
input-ar-rate = 20

# -> OSD
osc = no # replaced with uosc
osd-bar = no
osd-duration = 2000
osd-playing-msg = '▶ ${media-title:filename}'
osd-font = "Inter Medium"
osd-font-size = 36

# -> Window
border = no

#force-window = immediate
#keep-open = yes
keep-open-pause = no
#window-dragging = no
cursor-autohide = 150

reset-on-next-file = audio-delay,mute,pause,speed,sub-delay,video-aspect,video-pan-x,video-pan-y,video-rotate,video-zoom,volume

# use ontop-playback.lua to auto-ontop when playing (PIP)
#ontop = yes

# --- Subtitles ---

# -> Default Style
sub-font = 'Noto Serif CJK SC Semibold'
sub-font-size = 36
sub-color = '#FFFFFFFF'
sub-border-color = '#FF262626'
sub-border-size = 3.2
sub-shadow-offset = 1
sub-shadow-color = "#33000000"
sub-spacing = 0.5

# -> External
sub-auto = fuzzy
sub-file-paths = sub,subtitles,字幕,ass,srt
slang = 'chi,zh-CN,sc,chs,zh-HK,zh-TW,tc,cht'
#secondary-sid = 1
#sid = 2

# -> Fixes
blend-subtitles=yes
sub-ass-force-margins = no

# vsfilter/libass bugs
#sub-ass-vsfilter-aspect-compat = no # scale subtitles with video
#sub-ass-vsfilter-blur-compat = no # fixes blur

# --- Screenshots ---
screenshot-format = png
screenshot-directory = 'C:\Users\mocha\OneDrive\图片\Saved Pictures\mpv'

screenshot-tag-colorspace = yes
#screenshot-png-compression = 0
#screenshot-png-filter = 0

###########
# Scripts #
###########

script-opts = osc-scalewindowed=1.5,osc-hidetimeout=2000,console-scale=1
#scripts-append = '~~/scripts/modules.js'

############
# Profiles #
############

[interlaced]
profile-cond = p["video-frame-info/interlaced"]
vf=bwdif # apply FFMPEG's bwdif deinterlacer

[hdr]
profile-cond = (p["video-params/primaries"]=="bt.2020" or p["video-params/aspect"]>=2.0)

blend-subtitles = no # fix hdr peak
sub-ass-force-margins = yes

[low]
profile-cond = p["video-params/w"]<=1080 and p["video-params/h"]<=608
glsl-shaders-append = "~~/shaders/KrigBilateral.glsl"
glsl-shaders-append = "~~/shaders/FSRCNNX_x2_8-0-4-1.glsl"

[hd]
profile-cond = (p["video-params/w"]<1358 and p["video-params/h"]<764) and (p["video-params/w"]>=1080 or p["video-params/h"]>=608)

glsl-shaders-append = "~~/shaders/KrigBilateral.glsl"
glsl-shaders-append = "~~/shaders/SSimSuperRes.glsl"

sigmoid-upscaling = no # SSimSuperRes

[4k]
profile-cond = (p["video-params/w"]>2560 or p["video-params/h"]>1440)

glsl-shaders-append = "~~/shaders/SSimDownscaler.glsl"
linear-downscaling = no # for SSimDownscaler

# faster 0.5x prescaler https://gist.github.com/bjin/15f307e7a1bdb55842bbb663ee1950ed
# bypasses chroma upscaling for better performance
glsl-shaders-append = "~~/shaders/acme-0.5x.hook"

[protocol.http]
hls-bitrate=max # use max quality for HLS streams
cache=yes
no-cache-pause # don't pause when the cache runs low

[protocol.https]
profile=protocol.http

[protocol.ytdl]
profile=protocol.http
